generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String   @id @default(uuid())
  employeeId String   @unique
  name       String
  email      String   @unique
  loginType  String
  phone      String   @unique
  password   String
  branch     Branch
  role       String?
  date       DateTime @default(now())
  time       DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  employeeLoginDetails EmployeeLoginDetail[]
  auditLog             AuditLog[]
}

model EmployeeLoginDetail {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  loginTime DateTime @default(now())
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())
}

enum Branch {
  HYDERABAD_VS_HYD
  VIJAYAWADA_VS_BZA
  TIRUPATI_VS_TIR
  VIZAG_VS_VIZAG
  MUMBAI_VS_MUM
  BANGALURU_VS_BAN
  PUNE_VS_PUN
  ASSOCIATES_VS_MOU
  ONLINE
  GEORGIA
}

model StudentRegistration {
  id               String   @id @default(uuid())
  // Personal Information
  stid             String   @unique
  studentName      String
  nationality      String
  fathersName      String
  dateOfBirth      DateTime
  mobileNumber     String
  email            String   @unique
  parentMobile     String
  gender           String
  registrationDate DateTime @default(now())
  // Present Address
  addressLine1     String
  addressLine2     String?
  country          String
  state            String
  city             String
  district         String
  pincode          String
  // Course Details
  abroadMasters    String
  courseName       String
  serviceCharge    Float
  academicYear     String
  processedBy      String
  counselorName    String
  officeCity       String
  assigneeName     String
  passportNumber   String?

  status RegistrationStatus @default(HOLD)

  payment Payment?

  // System Fields
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum RegistrationStatus {
  CONFIRMED
  HOLD
  CANCELLED
}

model Payment {
  id String @id @default(uuid())

  feeType       String
  subFeeType    String?
  paymentMethod String
  amount        Float
  invoiceNumber String        @unique // VS-25-26/B01
  status        PaymentStatus @default(PENDING)
  bankDetails   String
  gst           Float?
  gstAmount     Float?
  referenceNo   String?

  studentId String              @unique
  student   StudentRegistration @relation(fields: [studentId], references: [id], onDelete: Cascade)
  date      DateTime            @default(now())
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
}

enum PaymentStatus {
  APPROVED
  PENDING
  FAILED
}

model AuditLog {
  id        String          @id @default(uuid())
  userId    String?
  role      String?
  module    String
  recordId  String
  action    AuditActionType
  oldValues Json?
  newValues Json?
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)
}

enum AuditActionType {
  CREATE
  UPDATE
  DELETE
}
